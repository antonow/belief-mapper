<!DOCTYPE html>
<meta charset="utf-8">
<style>

.link {
  stroke: #ccc;
}

.node text {
  pointer-events: none;
  font: 10px sans-serif;
}

</style>
<body>
<% if (defined?(@results)).nil? %>
  <!-- QUESTION DIV BEGINS HERE -->
  <div class="row">
    <!-- <div class="col-md-1"></div> -->
    <div class="col-md-3" >
    <% @belief = current_user.unexamined_beliefs.sample %>
    Do you believe <%= @belief.definition.sub(/belief /, "").sub(/doctrine /, "")%>?
    </div>
  <!-- </div> -->

    <!-- CONVICTION SLIDER DIV -->
    <!-- <div class="row"> -->
    <div class="col-md-7">
      <%= render partial: "slider_form", locals: { belief: @belief } %>
    </div>
  </div>
<hr>
<% end %>

<!-- PROGRESS BAR DIV BEGINS HERE -->
  <div class="row">
    <div class="progress" id="progress_bar">
      <div class="progress-bar" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: <%=current_user.percent_answered %>;">
        <%=current_user.percent_answered %>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-md-8"><h5>Percentage of questions answered</h5></div>
    <div class="col-md-4"><h5>You've answered <%=current_user.beliefs_answered.count%> questions and hold <%=current_user.held_beliefs.count%> beliefs.</h5></div>
  </div>



<hr>
<!-- GRAPH DIV BEGINS HERE -->
<div class="row">
  <div class="col-lg-10 graph">
    <% if (defined?(@results)).nil? %>
<script>
   $(function() {
      renderD3Web();
   });
</script>
<div id="selected_node" hidden></div>
<% else %>
<%= link_to 'Return to Graph', beliefs_path %><br><br>
<% your_beliefs = current_user.held_beliefs %>
<table class="table table-hover">
  <thead>
    <tr>
      <th>Name</th>
      <th>Definition</th>
      <th colspan="1"></th>
    </tr>
  </thead>
  <tbody>
  <% @results.each do |result| %>
    <tr>
      <td><%= result.name %></td>
      <td><%= result.definition %></td>
      <% unless your_beliefs.include?(result) %>
        <td><%= button_tag 'Subscribe', :class => 'subscribe ' + result.id.to_s %></td>
      <% else %>
        <td><%= button_to 'Unsubscribe', user_belief_path(result), method: :delete %></td>
      <% end %>
    </tr>
    <tr id=<%= result.id.to_s %> hidden><td colspan='3'><%= render partial: "slider_form", locals: { belief: result } %></td></tr>
  <% end %>
  </tbody>
</table>
<% end %>
</div>
<div class="col-lg-2 toolbar">
  <h3>Toolbar</h3>
  <hr>
      <%= form_for :belief, url: beliefs_path, method: :get do |f| %>
        <div class="field">
          <input type="text" id="query" name="query" placeholder="Search All Beliefs" />
          <%= f.submit "Search" %>
        </div>
        <div class="actions">
        </div><br>
      <% end %>

    <%= form_for :user_belief, url: user_belief_path(:user_belief), method: :delete do |f| %>
        <div class="field">
          <%= f.select(:name, current_user.beliefs.map { |belief| belief.name }, {include_blank: 'Select a belief to'}) %>
        </div>
      <div class="actions">
          <%= f.submit "Unsubscribe" %>
        </div><br>
      <% end %>

<hr>
    <p><%= link_to 'Sign Up', edit_user_registration_path %></p>
    <% if current_user.demographic.nil? %>
    <p><%= link_to 'Add Demographics', new_demographic_path %></p>
    <% else %>
    <p><%= link_to 'Edit Demographics', edit_demographic_path(current_user.demographic.id) %></p>
    <% end %>
    <p>Share your Map</p>
  </ul>

      <hr>
    <p>Take a Survey</p>
      <ul>
        <li>Philosophy</li>
        <li>Politics</li>
        <li>Religion</li>
      </ul>
  <hr>
  <p>Filter by</p>
      <ul>
        <li>Gender</li>
        <li>Age</li>
        <li>Location</li>
        <li>Religious Affiliation</li>
      </ul>

</div>

</div>

